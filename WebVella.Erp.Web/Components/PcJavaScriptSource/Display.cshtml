@addTagHelper *, WebVella.Erp.Plugins.Core
@addTagHelper *, WebVella.Erp.Web
@addTagHelper *, WebVella.TagHelpers
@using WebVella.Erp
@using WebVella.Erp.Web.Services
@using WebVella.Erp.Web.Utils;
@using WebVella.Erp.Web.Components;
@using WebVella.Erp.Web.Models;
@using WebVella.Erp.Web;
@{
    var options = (PcJavaScriptSource.PcJavaScriptSourceOptions)ViewBag.Options;

    var source = options.Source;

    if (!string.IsNullOrWhiteSpace(source) && source.StartsWith('/') && source.EndsWith(".js", StringComparison.OrdinalIgnoreCase))
    {
        var cacheKey = new RenderService().GetCacheKey();

        if (!string.IsNullOrWhiteSpace(cacheKey) )
            source = $"{source[0..source.LastIndexOf('.')]}-{cacheKey}.js";
    }
}

@if (options.IsAsync)
{
    <script src="@source" type="text/javascript" async></script>
}
else
{
    <script src="@source" type="text/javascript"></script>
}